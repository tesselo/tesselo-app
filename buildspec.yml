version: 0.2

phases:
  pre_build:
    commands:
      - apt-get update
      - echo "Upgrading node to version 6.x"
      - curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
      - apt-get install -y nodejs
      - echo Installing casperjs for e2e testing...
      - npm install -g phantomjs@2.1.1 casperjs@1.1.4
      - echo "Installing npm dependencies"
      - npm install
  build:
    commands:
      - echo Building Tesselo Frontend Vue Application for stage $STAGE
      - npm run build:$STAGE
      - echo "Pushing new build to s3://$BUCKET"
      - aws s3 sync --exclude *.js.map --acl public-read dist/ s3://$BUCKET
      - casperjs test --stage=$STAGE --username=$TEST_USER --password=$TEST_PASSWORD test/casper/tests
